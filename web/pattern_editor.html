<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ëª¬ìŠ¤í„° ASCII ì•„íŠ¸ ì—ë””í„°</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Consolas', 'Courier New', monospace;
            background-color: #1a1a2e;
            color: #eee;
            min-height: 100vh;
            padding: 20px;
        }

        h1 {
            text-align: center;
            color: #00ff88;
            margin-bottom: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 300px 1fr 300px;
            gap: 20px;
        }

        .panel {
            background: #16213e;
            border-radius: 10px;
            padding: 15px;
            border: 1px solid #0f3460;
        }

        .panel h2 {
            color: #00ff88;
            margin-bottom: 15px;
            font-size: 16px;
            border-bottom: 1px solid #0f3460;
            padding-bottom: 10px;
        }

        /* ëª¬ìŠ¤í„° ì„ íƒ */
        .monster-select {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .monster-btn {
            padding: 10px;
            background: #0f3460;
            border: 2px solid transparent;
            border-radius: 5px;
            color: #eee;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            font-family: inherit;
            font-size: 14px;
        }

        .monster-btn:hover {
            background: #1a4a7a;
        }

        .monster-btn.active {
            border-color: #00ff88;
            background: #1a4a7a;
        }

        .monster-btn .char {
            font-size: 20px;
            width: 30px;
            text-align: center;
        }

        /* í¬ê¸° ì„ íƒ */
        .scale-select {
            display: flex;
            gap: 5px;
            margin-bottom: 15px;
        }

        .scale-btn {
            flex: 1;
            padding: 8px;
            background: #0f3460;
            border: 2px solid transparent;
            border-radius: 5px;
            color: #eee;
            cursor: pointer;
            font-family: inherit;
        }

        .scale-btn:hover {
            background: #1a4a7a;
        }

        .scale-btn.active {
            border-color: #00ff88;
        }

        /* ì—ë””í„° ê·¸ë¦¬ë“œ */
        .editor-area {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .grid-container {
            background: #000;
            padding: 10px;
            border-radius: 10px;
            display: inline-block;
        }

        .grid {
            display: grid;
            gap: 1px;
            background: #333;
        }

        .grid-cell {
            width: 40px;
            height: 40px;
            background: #000;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            cursor: pointer;
            transition: background 0.1s;
            user-select: none;
        }

        .grid-cell:hover {
            background: #222;
        }

        .grid-cell.selected {
            background: #003300;
        }

        /* íŒ”ë ˆíŠ¸ */
        .palette-section {
            margin-bottom: 15px;
        }

        .palette-section h3 {
            font-size: 12px;
            color: #888;
            margin-bottom: 5px;
        }

        .palette {
            display: flex;
            flex-wrap: wrap;
            gap: 3px;
        }

        .palette-char {
            width: 32px;
            height: 32px;
            background: #0f3460;
            border: 2px solid transparent;
            border-radius: 3px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            cursor: pointer;
            color: #fff;
        }

        .palette-char:hover {
            background: #1a4a7a;
        }

        .palette-char.active {
            border-color: #00ff88;
            background: #1a4a7a;
        }

        /* ë¯¸ë¦¬ë³´ê¸° */
        .preview-section {
            margin-top: 20px;
        }

        .preview-box {
            background: #000;
            padding: 20px;
            border-radius: 10px;
            font-size: 18px;
            line-height: 1.2;
            white-space: pre;
            text-align: center;
            min-height: 200px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .preview-all {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .preview-item {
            text-align: center;
        }

        .preview-item .label {
            font-size: 12px;
            color: #888;
            margin-bottom: 5px;
        }

        /* ë²„íŠ¼ */
        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 10px 20px;
            background: #0f3460;
            border: none;
            border-radius: 5px;
            color: #eee;
            cursor: pointer;
            font-family: inherit;
            font-size: 14px;
        }

        .btn:hover {
            background: #1a4a7a;
        }

        .btn-primary {
            background: #00aa55;
        }

        .btn-primary:hover {
            background: #00cc66;
        }

        .btn-danger {
            background: #aa3333;
        }

        .btn-danger:hover {
            background: #cc4444;
        }

        /* ìƒ‰ìƒ ì„ íƒ */
        .color-picker {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .color-picker input {
            width: 50px;
            height: 30px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .color-picker span {
            font-size: 14px;
        }

        /* ì½”ë“œ ì¶œë ¥ */
        .code-output {
            background: #000;
            padding: 15px;
            border-radius: 10px;
            font-size: 12px;
            white-space: pre-wrap;
            word-break: break-all;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 10px;
        }

        /* ì‚¬ì´ì¦ˆ ì…ë ¥ */
        .size-inputs {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }

        .size-input {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .size-input label {
            font-size: 12px;
            color: #888;
        }

        .size-input input {
            padding: 8px;
            background: #0f3460;
            border: 1px solid #1a4a7a;
            border-radius: 5px;
            color: #eee;
            font-family: inherit;
            width: 100%;
        }

        /* ìƒˆ ëª¬ìŠ¤í„° ì¶”ê°€ */
        .new-monster {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #0f3460;
        }

        .new-monster input {
            width: 100%;
            padding: 8px;
            background: #0f3460;
            border: 1px solid #1a4a7a;
            border-radius: 5px;
            color: #eee;
            font-family: inherit;
            margin-bottom: 10px;
        }

        /* ë„ì›€ë§ */
        .help-text {
            font-size: 12px;
            color: #888;
            margin-top: 10px;
            line-height: 1.5;
        }

        /* íˆ´ë°” */
        .toolbar {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .tool-btn {
            padding: 8px 15px;
            background: #0f3460;
            border: 2px solid transparent;
            border-radius: 5px;
            color: #eee;
            cursor: pointer;
            font-family: inherit;
            font-size: 12px;
        }

        .tool-btn:hover {
            background: #1a4a7a;
        }

        .tool-btn.active {
            border-color: #00ff88;
        }
    </style>
</head>
<body>
    <h1>ğŸ¨ ëª¬ìŠ¤í„° ASCII ì•„íŠ¸ ì—ë””í„°</h1>

    <div class="container">
        <!-- ì™¼ìª½: ëª¬ìŠ¤í„° ì„ íƒ -->
        <div class="panel">
            <h2>ğŸ“‹ ëª¬ìŠ¤í„° ì„ íƒ</h2>
            <div class="monster-select" id="monsterList"></div>

            <div class="new-monster">
                <h3 style="font-size: 14px; margin-bottom: 10px;">â• ìƒˆ ëª¬ìŠ¤í„° ì¶”ê°€</h3>
                <input type="text" id="newMonsterChar" placeholder="ë¬¸ì (ì˜ˆ: k)" maxlength="1">
                <input type="text" id="newMonsterName" placeholder="ì´ë¦„ (ì˜ˆ: ì½”ë³¼íŠ¸)">
                <button class="btn btn-primary" onclick="addNewMonster()">ì¶”ê°€</button>
            </div>
        </div>

        <!-- ì¤‘ì•™: ì—ë””í„° -->
        <div class="panel">
            <h2>âœï¸ íŒ¨í„´ ì—ë””í„°</h2>

            <div class="scale-select" id="scaleSelect"></div>

            <div class="toolbar">
                <button class="tool-btn active" id="toolDraw" onclick="setTool('draw')">ğŸ–Œï¸ ê·¸ë¦¬ê¸°</button>
                <button class="tool-btn" id="toolErase" onclick="setTool('erase')">ğŸ§¹ ì§€ìš°ê¸°</button>
                <button class="tool-btn" id="toolFill" onclick="setTool('fill')">ğŸª£ ì±„ìš°ê¸°</button>
                <button class="tool-btn" onclick="clearGrid()">ğŸ—‘ï¸ ì „ì²´ ì§€ìš°ê¸°</button>
                <button class="tool-btn" onclick="flipHorizontal()">â†”ï¸ ì¢Œìš° ë°˜ì „</button>
            </div>

            <div class="editor-area">
                <div class="grid-container">
                    <div class="grid" id="grid"></div>
                </div>
            </div>

            <div class="preview-section">
                <h3 style="margin-bottom: 10px;">ğŸ‘ï¸ ëª¨ë“  í¬ê¸° ë¯¸ë¦¬ë³´ê¸°</h3>
                <div class="preview-box">
                    <div class="preview-all" id="previewAll"></div>
                </div>
            </div>
        </div>

        <!-- ì˜¤ë¥¸ìª½: íŒ”ë ˆíŠ¸ ë° ì„¤ì • -->
        <div class="panel">
            <h2>ğŸ¨ ë¬¸ì íŒ”ë ˆíŠ¸</h2>

            <div class="palette-section">
                <h3>ì±„ì›€ ë¸”ë¡</h3>
                <div class="palette" id="paletteBlocks"></div>
            </div>

            <div class="palette-section">
                <h3>ë°˜ ë¸”ë¡</h3>
                <div class="palette" id="paletteHalf"></div>
            </div>

            <div class="palette-section">
                <h3>ì‚¼ê°í˜•</h3>
                <div class="palette" id="paletteTriangles"></div>
            </div>

            <div class="palette-section">
                <h3>ëˆˆ/ì›</h3>
                <div class="palette" id="paletteEyes"></div>
            </div>

            <div class="palette-section">
                <h3>ë„í˜•</h3>
                <div class="palette" id="paletteShapes"></div>
            </div>

            <div class="palette-section">
                <h3>ê¸°íƒ€</h3>
                <div class="palette" id="paletteMisc"></div>
            </div>

            <h2 style="margin-top: 20px;">âš™ï¸ ì„¤ì •</h2>

            <div class="color-picker">
                <input type="color" id="monsterColor" value="#ff0000">
                <span>ëª¬ìŠ¤í„° ìƒ‰ìƒ</span>
            </div>

            <div class="size-inputs">
                <div class="size-input">
                    <label>ë†’ì´ ë°°ìœ¨</label>
                    <input type="number" id="sizeHeight" value="1.0" step="0.1" min="0.1" max="3.0">
                </div>
                <div class="size-input">
                    <label>ë„ˆë¹„ ë°°ìœ¨</label>
                    <input type="number" id="sizeWidth" value="1.0" step="0.1" min="0.1" max="3.0">
                </div>
                <div class="size-input">
                    <label>ë¬´ê²Œ</label>
                    <input type="number" id="sizeWeight" value="1.0" step="0.1" min="0.1" max="10.0">
                </div>
            </div>

            <div class="btn-group">
                <button class="btn btn-primary" onclick="savePattern()">ğŸ’¾ ì €ì¥</button>
                <button class="btn" onclick="exportCode()">ğŸ“‹ ì½”ë“œ ë³µì‚¬</button>
                <button class="btn" onclick="exportAllCode()">ğŸ“„ ì „ì²´ ë‚´ë³´ë‚´ê¸°</button>
                <button class="btn" onclick="toggleImportArea()">ğŸ“¥ ì½”ë“œ ê°€ì ¸ì˜¤ê¸°</button>
                <button class="btn btn-danger" onclick="resetCurrentMonster()">ğŸ”„ í˜„ì¬ ëª¬ìŠ¤í„° ë³µì›</button>
                <button class="btn btn-danger" onclick="resetAllPatterns()">âš ï¸ ì „ì²´ ì´ˆê¸°í™”</button>
            </div>

            <div id="importArea" style="display: none; margin-top: 10px;">
                <textarea id="importCode" placeholder="ì—¬ê¸°ì— ì½”ë“œë¥¼ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”..."
                    style="width: 100%; height: 150px; background: #000; color: #0f0; border: 1px solid #0f3460;
                    border-radius: 5px; padding: 10px; font-family: monospace; font-size: 12px; resize: vertical;"></textarea>
                <div style="display: flex; gap: 10px; margin-top: 10px;">
                    <button class="btn btn-primary" onclick="importCode()">âœ… ê°€ì ¸ì˜¤ê¸°</button>
                    <button class="btn" onclick="toggleImportArea()">ì·¨ì†Œ</button>
                </div>
            </div>

            <div class="code-output" id="codeOutput" style="display: none;"></div>

            <div class="help-text">
                <strong>ì‚¬ìš©ë²•:</strong><br>
                1. ì™¼ìª½ì—ì„œ ëª¬ìŠ¤í„° ì„ íƒ<br>
                2. í¬ê¸° ë‹¨ê³„ ì„ íƒ (5=ê°€ê¹Œì›€, 1=ë©€ë¦¬)<br>
                3. íŒ”ë ˆíŠ¸ì—ì„œ ë¬¸ì ì„ íƒ<br>
                4. ê·¸ë¦¬ë“œì— í´ë¦­í•˜ì—¬ ê·¸ë¦¬ê¸°<br>
                5. ì €ì¥ ë²„íŠ¼ìœ¼ë¡œ ì ìš©
            </div>
        </div>
    </div>

    <script src="monster_patterns.js"></script>
    <script>
        // í˜„ì¬ ìƒíƒœ
        let currentMonster = 'g';
        let currentScale = 5;
        let currentChar = 'â–ˆ';
        let currentTool = 'draw';
        let patterns = JSON.parse(JSON.stringify(MONSTER_PATTERNS));
        let isMouseDown = false;

        // ê·¸ë¦¬ë“œ í¬ê¸° (ìŠ¤ì¼€ì¼ë³„)
        const GRID_SIZES = {
            5: { cols: 7, rows: 7 },
            4: { cols: 5, rows: 5 },
            3: { cols: 3, rows: 3 },
            2: { cols: 2, rows: 2 },
            1: { cols: 1, rows: 1 }
        };

        // ì´ˆê¸°í™”
        function init() {
            renderMonsterList();
            renderScaleSelect();
            renderPalettes();
            renderGrid();
            updatePreview();

            // ìƒ‰ìƒ ë³€ê²½ ì´ë²¤íŠ¸
            document.getElementById('monsterColor').addEventListener('change', (e) => {
                patterns[currentMonster].color = e.target.value;
                updatePreview();
            });

            // ì‚¬ì´ì¦ˆ ë³€ê²½ ì´ë²¤íŠ¸
            ['sizeHeight', 'sizeWidth', 'sizeWeight'].forEach(id => {
                document.getElementById(id).addEventListener('change', updateSize);
            });

            // ë§ˆìš°ìŠ¤ ì´ë²¤íŠ¸
            document.addEventListener('mouseup', () => isMouseDown = false);
        }

        // ëª¬ìŠ¤í„° ëª©ë¡ ë Œë”ë§
        function renderMonsterList() {
            const container = document.getElementById('monsterList');
            container.innerHTML = '';

            for (const [char, data] of Object.entries(patterns)) {
                if (char === 'default') continue;

                const btn = document.createElement('button');
                btn.className = `monster-btn ${char === currentMonster ? 'active' : ''}`;
                btn.innerHTML = `
                    <span class="char" style="color: ${data.color}">${char}</span>
                    <span>${data.name}</span>
                `;
                btn.onclick = () => selectMonster(char);
                container.appendChild(btn);
            }
        }

        // í¬ê¸° ì„ íƒ ë Œë”ë§
        function renderScaleSelect() {
            const container = document.getElementById('scaleSelect');
            container.innerHTML = '';

            const labels = { 5: 'ë§¤ìš° ê°€ê¹Œì›€', 4: 'ê°€ê¹Œì›€', 3: 'ë³´í†µ', 2: 'ë©€ë¦¬', 1: 'ë§¤ìš° ë©€ë¦¬' };

            for (let i = 5; i >= 1; i--) {
                const btn = document.createElement('button');
                btn.className = `scale-btn ${i === currentScale ? 'active' : ''}`;
                btn.textContent = `${i}: ${labels[i]}`;
                btn.onclick = () => selectScale(i);
                container.appendChild(btn);
            }
        }

        // íŒ”ë ˆíŠ¸ ë Œë”ë§
        function renderPalettes() {
            const sections = {
                'paletteBlocks': ASCII_PALETTE.blocks,
                'paletteHalf': ASCII_PALETTE.half,
                'paletteTriangles': ASCII_PALETTE.triangles,
                'paletteEyes': ASCII_PALETTE.eyes,
                'paletteShapes': ASCII_PALETTE.shapes,
                'paletteMisc': ASCII_PALETTE.misc
            };

            for (const [id, chars] of Object.entries(sections)) {
                const container = document.getElementById(id);
                container.innerHTML = '';

                for (const char of chars) {
                    const btn = document.createElement('button');
                    btn.className = `palette-char ${char === currentChar ? 'active' : ''}`;
                    btn.textContent = char;
                    btn.onclick = () => selectChar(char);
                    container.appendChild(btn);
                }
            }
        }

        // ê·¸ë¦¬ë“œ ë Œë”ë§
        function renderGrid() {
            const container = document.getElementById('grid');
            const size = GRID_SIZES[currentScale];
            const pattern = patterns[currentMonster]?.patterns?.[currentScale] || [];

            container.style.gridTemplateColumns = `repeat(${size.cols}, 40px)`;
            container.innerHTML = '';

            for (let y = 0; y < size.rows; y++) {
                for (let x = 0; x < size.cols; x++) {
                    const cell = document.createElement('div');
                    cell.className = 'grid-cell';
                    cell.dataset.x = x;
                    cell.dataset.y = y;

                    // í˜„ì¬ íŒ¨í„´ì—ì„œ ë¬¸ì ê°€ì ¸ì˜¤ê¸°
                    const char = pattern[y]?.[x] || ' ';
                    cell.textContent = char;
                    cell.style.color = patterns[currentMonster]?.color || '#fff';

                    // ì´ë²¤íŠ¸
                    cell.onmousedown = (e) => {
                        isMouseDown = true;
                        handleCellClick(x, y, e);
                    };
                    cell.onmouseenter = (e) => {
                        if (isMouseDown) handleCellClick(x, y, e);
                    };

                    container.appendChild(cell);
                }
            }
        }

        // ì…€ í´ë¦­ ì²˜ë¦¬
        function handleCellClick(x, y, e) {
            e.preventDefault();

            const size = GRID_SIZES[currentScale];
            let pattern = patterns[currentMonster].patterns[currentScale];

            // íŒ¨í„´ ë°°ì—´ ì´ˆê¸°í™” (ì—†ìœ¼ë©´)
            if (!pattern || !Array.isArray(pattern)) {
                pattern = [];
                for (let i = 0; i < size.rows; i++) {
                    pattern.push(' '.repeat(size.cols));
                }
                patterns[currentMonster].patterns[currentScale] = pattern;
            }

            // í–‰ì„ ë°°ì—´ë¡œ ë³€í™˜, ìˆ˜ì •, ë‹¤ì‹œ ë¬¸ìì—´ë¡œ
            let row = pattern[y].split('');

            if (currentTool === 'draw') {
                row[x] = currentChar;
            } else if (currentTool === 'erase') {
                row[x] = ' ';
            } else if (currentTool === 'fill') {
                fillArea(x, y, currentChar);
                renderGrid();
                updatePreview();
                return;
            }

            pattern[y] = row.join('');
            patterns[currentMonster].patterns[currentScale] = pattern;

            renderGrid();
            updatePreview();
        }

        // ì˜ì—­ ì±„ìš°ê¸°
        function fillArea(startX, startY, newChar) {
            const size = GRID_SIZES[currentScale];
            let pattern = patterns[currentMonster].patterns[currentScale];
            const targetChar = pattern[startY]?.[startX] || ' ';

            if (targetChar === newChar) return;

            const stack = [[startX, startY]];
            const visited = new Set();

            while (stack.length > 0) {
                const [x, y] = stack.pop();
                const key = `${x},${y}`;

                if (visited.has(key)) continue;
                if (x < 0 || x >= size.cols || y < 0 || y >= size.rows) continue;

                const currentCell = pattern[y]?.[x] || ' ';
                if (currentCell !== targetChar) continue;

                visited.add(key);

                let row = pattern[y].split('');
                row[x] = newChar;
                pattern[y] = row.join('');

                stack.push([x + 1, y], [x - 1, y], [x, y + 1], [x, y - 1]);
            }

            patterns[currentMonster].patterns[currentScale] = pattern;
        }

        // ëª¬ìŠ¤í„° ì„ íƒ
        function selectMonster(char) {
            currentMonster = char;
            renderMonsterList();
            renderGrid();
            updatePreview();
            updateSettingsUI();
        }

        // í¬ê¸° ì„ íƒ
        function selectScale(scale) {
            currentScale = scale;
            renderScaleSelect();
            renderGrid();
        }

        // ë¬¸ì ì„ íƒ
        function selectChar(char) {
            currentChar = char;
            renderPalettes();
        }

        // ë„êµ¬ ì„ íƒ
        function setTool(tool) {
            currentTool = tool;
            document.querySelectorAll('.tool-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.getElementById('tool' + tool.charAt(0).toUpperCase() + tool.slice(1)).classList.add('active');
        }

        // ê·¸ë¦¬ë“œ ì§€ìš°ê¸°
        function clearGrid() {
            const size = GRID_SIZES[currentScale];
            const pattern = [];
            for (let i = 0; i < size.rows; i++) {
                pattern.push(' '.repeat(size.cols));
            }
            patterns[currentMonster].patterns[currentScale] = pattern;
            renderGrid();
            updatePreview();
        }

        // ì¢Œìš° ë°˜ì „
        function flipHorizontal() {
            let pattern = patterns[currentMonster].patterns[currentScale];
            if (!pattern) return;

            patterns[currentMonster].patterns[currentScale] = pattern.map(row =>
                row.split('').reverse().join('')
            );
            renderGrid();
            updatePreview();
        }

        // ì„¤ì • UI ì—…ë°ì´íŠ¸
        function updateSettingsUI() {
            const data = patterns[currentMonster];
            document.getElementById('monsterColor').value = data.color || '#ffffff';
            document.getElementById('sizeHeight').value = data.size?.height || 1.0;
            document.getElementById('sizeWidth').value = data.size?.width || 1.0;
            document.getElementById('sizeWeight').value = data.size?.weight || 1.0;
        }

        // ì‚¬ì´ì¦ˆ ì—…ë°ì´íŠ¸
        function updateSize() {
            patterns[currentMonster].size = {
                height: parseFloat(document.getElementById('sizeHeight').value) || 1.0,
                width: parseFloat(document.getElementById('sizeWidth').value) || 1.0,
                weight: parseFloat(document.getElementById('sizeWeight').value) || 1.0
            };
        }

        // ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸
        function updatePreview() {
            const container = document.getElementById('previewAll');
            container.innerHTML = '';

            const color = patterns[currentMonster]?.color || '#fff';

            for (let scale = 5; scale >= 1; scale--) {
                const pattern = patterns[currentMonster]?.patterns?.[scale] || ['?'];

                const item = document.createElement('div');
                item.className = 'preview-item';
                item.innerHTML = `
                    <div class="label">í¬ê¸° ${scale}</div>
                    <pre style="color: ${color}; line-height: 1.2;">${pattern.join('\n')}</pre>
                `;
                container.appendChild(item);
            }
        }

        // ìƒˆ ëª¬ìŠ¤í„° ì¶”ê°€
        function addNewMonster() {
            const char = document.getElementById('newMonsterChar').value.trim();
            const name = document.getElementById('newMonsterName').value.trim();

            if (!char || !name) {
                alert('ë¬¸ìì™€ ì´ë¦„ì„ ëª¨ë‘ ì…ë ¥í•˜ì„¸ìš”.');
                return;
            }

            if (patterns[char]) {
                alert('ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ë¬¸ìì…ë‹ˆë‹¤.');
                return;
            }

            // ê¸°ë³¸ íŒ¨í„´ ë³µì‚¬
            patterns[char] = {
                name: name,
                color: '#ff0000',
                size: { height: 1.0, width: 1.0, weight: 1.0 },
                patterns: JSON.parse(JSON.stringify(patterns['default'].patterns))
            };

            // ê¸°ë³¸ íŒ¨í„´ì—ì„œ ? ë¥¼ ìƒˆ ë¬¸ìë¡œ êµì²´
            for (let scale = 1; scale <= 5; scale++) {
                patterns[char].patterns[scale] = patterns[char].patterns[scale].map(
                    row => row.replace(/\?/g, char)
                );
            }

            document.getElementById('newMonsterChar').value = '';
            document.getElementById('newMonsterName').value = '';

            renderMonsterList();
            selectMonster(char);
        }

        // íŒ¨í„´ ì €ì¥ (ë¡œì»¬)
        function savePattern() {
            localStorage.setItem('monster_patterns', JSON.stringify(patterns));
            alert('íŒ¨í„´ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!\n\nê²Œì„ì— ì ìš©í•˜ë ¤ë©´ "ì „ì²´ ë‚´ë³´ë‚´ê¸°"ë¥¼ ëˆŒëŸ¬\nmonster_patterns.js íŒŒì¼ì„ ì—…ë°ì´íŠ¸í•˜ì„¸ìš”.');
        }

        // ë‹¨ì¼ ëª¬ìŠ¤í„° ì½”ë“œ ë³µì‚¬
        function exportCode() {
            const char = currentMonster;
            const data = patterns[char];

            const code = `'${char}': {
    name: '${data.name}',
    color: '${data.color}',
    size: { height: ${data.size.height}, width: ${data.size.width}, weight: ${data.size.weight} },
    patterns: {
${Object.entries(data.patterns).map(([scale, pattern]) => `        ${scale}: [
${pattern.map(row => `            "${row}"`).join(',\n')}
        ]`).join(',\n')}
    }
}`;

            document.getElementById('codeOutput').style.display = 'block';
            document.getElementById('codeOutput').textContent = code;

            navigator.clipboard.writeText(code).then(() => {
                alert('ì½”ë“œê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
            });
        }

        // í˜„ì¬ ëª¬ìŠ¤í„° ë³µì›
        function resetCurrentMonster() {
            if (!confirm(`'${patterns[currentMonster].name}' íŒ¨í„´ì„ ì›ë˜ëŒ€ë¡œ ë³µì›í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì €ì¥í•˜ì§€ ì•Šì€ ë³€ê²½ì‚¬í•­ì´ ì‚¬ë¼ì§‘ë‹ˆë‹¤.`)) {
                return;
            }

            if (MONSTER_PATTERNS[currentMonster]) {
                patterns[currentMonster] = JSON.parse(JSON.stringify(MONSTER_PATTERNS[currentMonster]));
                renderGrid();
                updatePreview();
                updateSettingsUI();
                alert('íŒ¨í„´ì´ ì›ë˜ëŒ€ë¡œ ë³µì›ë˜ì—ˆìŠµë‹ˆë‹¤.');
            } else {
                alert('ì›ë³¸ íŒ¨í„´ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            }
        }

        // ì „ì²´ íŒ¨í„´ ì´ˆê¸°í™”
        function resetAllPatterns() {
            if (!confirm('âš ï¸ ê²½ê³ !\n\nëª¨ë“  íŒ¨í„´ì„ ì›ë˜ëŒ€ë¡œ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì €ì¥í•˜ì§€ ì•Šì€ ëª¨ë“  ë³€ê²½ì‚¬í•­ì´ ì‚¬ë¼ì§‘ë‹ˆë‹¤.')) {
                return;
            }

            if (!confirm('âš ï¸ ì •ë§ë¡œ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!')) {
                return;
            }

            patterns = JSON.parse(JSON.stringify(MONSTER_PATTERNS));
            localStorage.removeItem('monster_patterns');
            renderMonsterList();
            renderGrid();
            updatePreview();
            updateSettingsUI();
            alert('ëª¨ë“  íŒ¨í„´ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
        }

        // ì½”ë“œ ê°€ì ¸ì˜¤ê¸° ì˜ì—­ í† ê¸€
        function toggleImportArea() {
            const area = document.getElementById('importArea');
            area.style.display = area.style.display === 'none' ? 'block' : 'none';
            if (area.style.display === 'block') {
                document.getElementById('importCode').value = '';
                document.getElementById('importCode').focus();
            }
        }

        // ì½”ë“œ ê°€ì ¸ì˜¤ê¸°
        function importCode() {
            const code = document.getElementById('importCode').value.trim();

            if (!code) {
                alert('ì½”ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            try {
                let parsedData;

                // const MONSTER_PATTERNS = { ... } í˜•ì‹ ì²˜ë¦¬
                if (code.includes('MONSTER_PATTERNS')) {
                    // MONSTER_PATTERNS ê°ì²´ ì¶”ì¶œ
                    const match = code.match(/(?:const|let|var)?\s*(?:MONSTER_PATTERNS|window\.MONSTER_PATTERNS)\s*=\s*(\{[\s\S]*\});?/);
                    if (match) {
                        parsedData = eval('(' + match[1] + ')');
                    } else {
                        throw new Error('MONSTER_PATTERNS í˜•ì‹ì„ íŒŒì‹±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    }
                }
                // ë‹¨ì¼ ëª¬ìŠ¤í„° í˜•ì‹: 'g': { ... }
                else if (code.match(/^['"].\s*['"]:\s*\{/)) {
                    parsedData = eval('({' + code + '})');
                }
                // ê°ì²´ í˜•ì‹: { 'g': { ... } }
                else if (code.startsWith('{')) {
                    parsedData = eval('(' + code + ')');
                }
                else {
                    throw new Error('ì¸ì‹í•  ìˆ˜ ì—†ëŠ” ì½”ë“œ í˜•ì‹ì…ë‹ˆë‹¤.');
                }

                // ìœ íš¨ì„± ê²€ì‚¬
                if (typeof parsedData !== 'object' || parsedData === null) {
                    throw new Error('ìœ íš¨í•œ íŒ¨í„´ ë°ì´í„°ê°€ ì•„ë‹™ë‹ˆë‹¤.');
                }

                // íŒ¨í„´ ë³‘í•©
                let importedCount = 0;
                for (const [char, data] of Object.entries(parsedData)) {
                    if (data.name && data.patterns) {
                        patterns[char] = data;
                        importedCount++;
                    }
                }

                if (importedCount === 0) {
                    throw new Error('ê°€ì ¸ì˜¬ ìˆ˜ ìˆëŠ” íŒ¨í„´ì´ ì—†ìŠµë‹ˆë‹¤.');
                }

                // UI ì—…ë°ì´íŠ¸
                renderMonsterList();
                renderGrid();
                updatePreview();
                updateSettingsUI();
                toggleImportArea();

                alert(`${importedCount}ê°œì˜ ëª¬ìŠ¤í„° íŒ¨í„´ì„ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤!`);

            } catch (e) {
                alert('ì½”ë“œ íŒŒì‹± ì˜¤ë¥˜:\n' + e.message + '\n\nì˜¬ë°”ë¥¸ í˜•ì‹ì˜ ì½”ë“œë¥¼ ë¶™ì—¬ë„£ì–´ì£¼ì„¸ìš”.');
                console.error('Import error:', e);
            }
        }

        // ì „ì²´ ì½”ë“œ ë‚´ë³´ë‚´ê¸°
        function exportAllCode() {
            let code = `const MONSTER_PATTERNS = {\n`;

            for (const [char, data] of Object.entries(patterns)) {
                code += `    '${char}': {
        name: '${data.name}',
        color: '${data.color}',
        size: { height: ${data.size.height}, width: ${data.size.width}, weight: ${data.size.weight} },
        patterns: {
${Object.entries(data.patterns).map(([scale, pattern]) => `            ${scale}: [
${pattern.map(row => `                "${row}"`).join(',\n')}
            ]`).join(',\n')}
        }
    },\n`;
            }

            code += `};\n\nwindow.MONSTER_PATTERNS = MONSTER_PATTERNS;`;

            document.getElementById('codeOutput').style.display = 'block';
            document.getElementById('codeOutput').textContent = code;

            navigator.clipboard.writeText(code).then(() => {
                alert('ì „ì²´ ì½”ë“œê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!\n\nmonster_patterns.js íŒŒì¼ì— ë¶™ì—¬ë„£ìœ¼ì„¸ìš”.');
            });
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì €ì¥ëœ íŒ¨í„´ ë¶ˆëŸ¬ì˜¤ê¸°
        window.onload = () => {
            const saved = localStorage.getItem('monster_patterns');
            if (saved) {
                try {
                    patterns = JSON.parse(saved);
                } catch (e) {
                    console.error('ì €ì¥ëœ íŒ¨í„´ ë¡œë“œ ì‹¤íŒ¨:', e);
                }
            }
            init();
        };
    </script>
</body>
</html>
