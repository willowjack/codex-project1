<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì•„ì´í…œ ASCII ì•„íŠ¸ ì—ë””í„°</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Consolas', 'Courier New', monospace;
            background-color: #1a1a2e;
            color: #eee;
            min-height: 100vh;
            padding: 20px;
        }

        /* ë„¤ë¹„ê²Œì´ì…˜ ë°” */
        .nav-bar {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
            padding: 15px;
            background: #16213e;
            border-radius: 10px;
            border: 1px solid #0f3460;
        }

        .nav-btn {
            padding: 10px 20px;
            background: #0f3460;
            border: 2px solid transparent;
            border-radius: 5px;
            color: #eee;
            cursor: pointer;
            font-family: inherit;
            font-size: 14px;
            text-decoration: none;
            transition: all 0.2s;
        }

        .nav-btn:hover {
            background: #1a4a7a;
            transform: translateY(-2px);
        }

        .nav-btn.active {
            border-color: #ff9900;
            background: #1a4a7a;
            color: #ff9900;
        }

        .nav-btn.game-btn {
            background: #2d5016;
        }

        .nav-btn.game-btn:hover {
            background: #3d6a1e;
        }

        h1 {
            text-align: center;
            color: #ff9900;
            margin-bottom: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 300px 1fr 300px;
            gap: 20px;
        }

        .panel {
            background: #16213e;
            border-radius: 10px;
            padding: 15px;
            border: 1px solid #0f3460;
        }

        .panel h2 {
            color: #ff9900;
            margin-bottom: 15px;
            font-size: 16px;
            border-bottom: 1px solid #0f3460;
            padding-bottom: 10px;
        }

        /* ì•„ì´í…œ ì„ íƒ */
        .item-select {
            display: flex;
            flex-direction: column;
            gap: 8px;
            max-height: 400px;
            overflow-y: auto;
        }

        .item-btn {
            padding: 10px;
            background: #0f3460;
            border: 2px solid transparent;
            border-radius: 5px;
            color: #eee;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            font-family: inherit;
            font-size: 14px;
        }

        .item-btn:hover {
            background: #1a4a7a;
        }

        .item-btn.active {
            border-color: #ff9900;
            background: #1a4a7a;
        }

        .item-btn .char {
            font-size: 20px;
            width: 30px;
            text-align: center;
        }

        .item-btn .type-badge {
            font-size: 10px;
            padding: 2px 6px;
            background: #333;
            border-radius: 3px;
            margin-left: auto;
        }

        /* ìƒˆ ì•„ì´í…œ ì¶”ê°€ */
        .new-item {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #0f3460;
        }

        .new-item input {
            width: 100%;
            padding: 8px;
            margin-bottom: 8px;
            background: #0f3460;
            border: 1px solid #1a4a7a;
            border-radius: 5px;
            color: #eee;
            font-family: inherit;
        }

        /* í¬ê¸° ì„ íƒ */
        .scale-select {
            display: flex;
            gap: 5px;
            margin-bottom: 15px;
        }

        .scale-btn {
            flex: 1;
            padding: 8px;
            background: #0f3460;
            border: 2px solid transparent;
            border-radius: 5px;
            color: #eee;
            cursor: pointer;
            font-family: inherit;
            font-size: 11px;
        }

        .scale-btn:hover {
            background: #1a4a7a;
        }

        .scale-btn.active {
            border-color: #ff9900;
            background: #1a4a7a;
        }

        /* ì—ë””í„° ì˜ì—­ */
        .editor-area {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }

        .grid-container {
            background: #0a0a15;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #0f3460;
        }

        .grid {
            display: grid;
            gap: 1px;
            background: #333;
        }

        .grid-cell {
            width: 40px;
            height: 40px;
            background: #0a0a15;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            cursor: crosshair;
            user-select: none;
        }

        .grid-cell:hover {
            background: #1a1a3e;
        }

        /* ë¯¸ë¦¬ë³´ê¸° */
        .preview-section {
            background: #0a0a15;
            border-radius: 10px;
            padding: 15px;
            border: 1px solid #0f3460;
        }

        .preview-box {
            display: flex;
            justify-content: center;
        }

        .preview-all {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .preview-item {
            text-align: center;
        }

        .preview-item .label {
            font-size: 12px;
            color: #888;
            margin-bottom: 5px;
        }

        .preview-item pre {
            font-family: inherit;
            font-size: 14px;
            background: #000;
            padding: 10px;
            border-radius: 5px;
        }

        /* íŒ”ë ˆíŠ¸ */
        .palette-section {
            margin-bottom: 15px;
        }

        .palette-section h3 {
            font-size: 12px;
            color: #888;
            margin-bottom: 8px;
        }

        .palette {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
        }

        .palette-char {
            width: 30px;
            height: 30px;
            background: #0f3460;
            border: 2px solid transparent;
            border-radius: 3px;
            color: #fff;
            cursor: pointer;
            font-family: inherit;
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .palette-char:hover {
            background: #1a4a7a;
        }

        .palette-char.active {
            border-color: #ff9900;
        }

        /* ì„¤ì • */
        .color-picker {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .color-picker input {
            width: 50px;
            height: 30px;
            border: none;
            cursor: pointer;
        }

        .size-inputs {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }

        .size-input label {
            display: block;
            font-size: 11px;
            color: #888;
            margin-bottom: 4px;
        }

        .size-input input, .size-input select {
            width: 100%;
            padding: 6px;
            background: #0f3460;
            border: 1px solid #1a4a7a;
            border-radius: 5px;
            color: #eee;
            font-family: inherit;
            font-size: 12px;
        }

        /* ë²„íŠ¼ */
        .btn-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 15px;
        }

        .btn {
            padding: 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-family: inherit;
            font-size: 12px;
            transition: all 0.2s;
        }

        .btn-primary {
            background: #ff9900;
            color: #000;
        }

        .btn-primary:hover {
            background: #ffaa33;
        }

        .btn {
            background: #0f3460;
            color: #eee;
        }

        .btn:hover {
            background: #1a4a7a;
        }

        .btn-danger {
            background: #8b0000;
            color: #fff;
        }

        .btn-danger:hover {
            background: #a00;
        }

        /* ì½”ë“œ ì¶œë ¥ */
        .code-output {
            background: #000;
            color: #0f0;
            padding: 15px;
            border-radius: 5px;
            font-size: 11px;
            white-space: pre-wrap;
            word-break: break-all;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 15px;
        }

        /* ë„ì›€ë§ */
        .help-text {
            margin-top: 15px;
            padding: 10px;
            background: #0a0a15;
            border-radius: 5px;
            font-size: 11px;
            color: #888;
            line-height: 1.6;
        }

        /* íˆ´ë°” */
        .toolbar {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .tool-btn {
            padding: 8px 15px;
            background: #0f3460;
            border: 2px solid transparent;
            border-radius: 5px;
            color: #eee;
            cursor: pointer;
            font-family: inherit;
            font-size: 12px;
        }

        .tool-btn:hover {
            background: #1a4a7a;
        }

        .tool-btn.active {
            border-color: #ff9900;
        }

        /* ì•„ì´í…œ íƒ€ì…ë³„ ìƒ‰ìƒ */
        .type-weapon { color: #c0c0c0; }
        .type-armor { color: #808080; }
        .type-consumable { color: #00ff00; }
        .type-potion { color: #ff00ff; }
        .type-scroll { color: #ffa500; }
        .type-key { color: #ffcc00; }
        .type-gold { color: #ffd700; }
        .type-misc { color: #ffffff; }
    </style>
</head>
<body>
    <!-- ë„¤ë¹„ê²Œì´ì…˜ ë°” -->
    <div class="nav-bar">
        <a href="pattern_editor.html" class="nav-btn">ğŸ¨ ëª¬ìŠ¤í„° ì•„íŠ¸ ì—ë””í„°</a>
        <a href="item_editor.html" class="nav-btn active">ğŸ’ ì•„ì´í…œ ì—ë””í„°</a>
        <a href="quest_editor.html" class="nav-btn">ğŸ“œ í€˜ìŠ¤íŠ¸ ì—ë””í„°</a>
        <a href="index.html" class="nav-btn game-btn">ğŸ® ê²Œì„ìœ¼ë¡œ</a>
    </div>

    <h1>ğŸ’ ì•„ì´í…œ ASCII ì•„íŠ¸ ì—ë””í„°</h1>

    <div class="container">
        <!-- ì™¼ìª½: ì•„ì´í…œ ì„ íƒ -->
        <div class="panel">
            <h2>ğŸ“‹ ì•„ì´í…œ ì„ íƒ</h2>
            <div class="item-select" id="itemList"></div>

            <div class="new-item">
                <h3 style="font-size: 14px; margin-bottom: 10px;">â• ìƒˆ ì•„ì´í…œ ì¶”ê°€</h3>
                <input type="text" id="newItemChar" placeholder="ë¬¸ì (ì˜ˆ: +)" maxlength="1">
                <input type="text" id="newItemName" placeholder="ì´ë¦„ (ì˜ˆ: ì²´ë ¥ ë¬¼ì•½)">
                <select id="newItemType" style="width: 100%; padding: 8px; margin-bottom: 8px; background: #0f3460; border: 1px solid #1a4a7a; border-radius: 5px; color: #eee;">
                    <option value="consumable">ì†Œë¹„ ì•„ì´í…œ</option>
                    <option value="weapon">ë¬´ê¸°</option>
                    <option value="armor">ë°©ì–´êµ¬</option>
                    <option value="potion">ë¬¼ì•½</option>
                    <option value="scroll">ìŠ¤í¬ë¡¤</option>
                    <option value="key">ì—´ì‡ </option>
                    <option value="gold">ê¸ˆí™”</option>
                    <option value="misc">ê¸°íƒ€</option>
                </select>
                <button class="btn btn-primary" onclick="addNewItem()">ì¶”ê°€</button>
            </div>
        </div>

        <!-- ì¤‘ì•™: ì—ë””í„° -->
        <div class="panel">
            <h2>âœï¸ íŒ¨í„´ ì—ë””í„°</h2>

            <div class="scale-select" id="scaleSelect"></div>

            <div class="toolbar">
                <button class="tool-btn active" id="toolDraw" onclick="setTool('draw')">ğŸ–Œï¸ ê·¸ë¦¬ê¸°</button>
                <button class="tool-btn" id="toolErase" onclick="setTool('erase')">ğŸ§¹ ì§€ìš°ê¸°</button>
                <button class="tool-btn" id="toolFill" onclick="setTool('fill')">ğŸª£ ì±„ìš°ê¸°</button>
                <button class="tool-btn" id="toolDrag" onclick="toggleDragMode()">âœ‹ ë“œë˜ê·¸ ëª¨ë“œ</button>
                <button class="tool-btn" onclick="clearGrid()">ğŸ—‘ï¸ ì „ì²´ ì§€ìš°ê¸°</button>
                <button class="tool-btn" onclick="flipHorizontal()">â†”ï¸ ì¢Œìš° ë°˜ì „</button>
            </div>

            <div class="editor-area">
                <div class="grid-container">
                    <div class="grid" id="grid"></div>
                </div>
            </div>

            <div class="preview-section">
                <h3 style="margin-bottom: 10px;">ğŸ‘ï¸ ëª¨ë“  í¬ê¸° ë¯¸ë¦¬ë³´ê¸°</h3>
                <div class="preview-box">
                    <div class="preview-all" id="previewAll"></div>
                </div>
            </div>
        </div>

        <!-- ì˜¤ë¥¸ìª½: íŒ”ë ˆíŠ¸ ë° ì„¤ì • -->
        <div class="panel">
            <h2>ğŸ¨ ë¬¸ì íŒ”ë ˆíŠ¸</h2>

            <div class="palette-section">
                <h3>ì±„ì›€ ë¸”ë¡</h3>
                <div class="palette" id="paletteBlocks"></div>
            </div>

            <div class="palette-section">
                <h3>ë°˜ ë¸”ë¡</h3>
                <div class="palette" id="paletteHalf"></div>
            </div>

            <div class="palette-section">
                <h3>ë„í˜•</h3>
                <div class="palette" id="paletteShapes"></div>
            </div>

            <div class="palette-section">
                <h3>ê¸°íƒ€</h3>
                <div class="palette" id="paletteMisc"></div>
            </div>

            <h2 style="margin-top: 20px;">ğŸ“¦ ì•„ì´í…œ ì†ì„±</h2>

            <div class="size-inputs">
                <div class="size-input">
                    <label>ì•„ì´í…œ íƒ€ì…</label>
                    <select id="itemType">
                        <option value="consumable">ğŸ– ì†Œë¹„</option>
                        <option value="weapon">âš”ï¸ ë¬´ê¸°</option>
                        <option value="armor">ğŸ›¡ï¸ ë°©ì–´êµ¬</option>
                        <option value="potion">ğŸ§ª ë¬¼ì•½</option>
                        <option value="scroll">ğŸ“œ ìŠ¤í¬ë¡¤</option>
                        <option value="key">ğŸ”‘ ì—´ì‡ </option>
                        <option value="gold">ğŸ’° ê¸ˆí™”</option>
                        <option value="misc">ğŸ“¦ ê¸°íƒ€</option>
                    </select>
                </div>
                <div class="size-input">
                    <label>í¬ê·€ë„</label>
                    <select id="itemRarity">
                        <option value="common">ì¼ë°˜</option>
                        <option value="uncommon">ê³ ê¸‰</option>
                        <option value="rare">í¬ê·€</option>
                        <option value="epic">ì˜ì›…</option>
                        <option value="legendary">ì „ì„¤</option>
                    </select>
                </div>
            </div>

            <div class="size-inputs">
                <div class="size-input">
                    <label>ê°€ì¹˜ (ê³¨ë“œ)</label>
                    <input type="number" id="itemValue" value="10" min="0" max="9999">
                </div>
                <div class="size-input">
                    <label>ë¬´ê²Œ</label>
                    <input type="number" id="itemWeight" value="1.0" step="0.1" min="0" max="100">
                </div>
            </div>

            <div class="size-inputs">
                <div class="size-input">
                    <label>íš¨ê³¼ëŸ‰</label>
                    <input type="number" id="itemEffect" value="0" min="-100" max="100">
                </div>
                <div class="size-input">
                    <label>ìŠ¤íƒ ê°€ëŠ¥</label>
                    <select id="itemStackable">
                        <option value="true">ì˜ˆ</option>
                        <option value="false">ì•„ë‹ˆì˜¤</option>
                    </select>
                </div>
            </div>

            <div style="margin: 10px 0;">
                <label style="font-size: 12px; color: #888;">íš¨ê³¼ íƒ€ì…</label>
                <select id="itemEffectType" style="width: 100%; padding: 8px; background: #0f3460; border: 1px solid #1a4a7a; border-radius: 5px; color: #eee; font-family: inherit;">
                    <option value="none">ì—†ìŒ</option>
                    <option value="heal_hp">â¤ï¸ HP íšŒë³µ</option>
                    <option value="heal_mp">ğŸ’™ MP íšŒë³µ</option>
                    <option value="damage">âš”ï¸ ê³µê²©ë ¥ ì¦ê°€</option>
                    <option value="defense">ğŸ›¡ï¸ ë°©ì–´ë ¥ ì¦ê°€</option>
                    <option value="speed">ğŸ’¨ ì´ë™ì†ë„ ì¦ê°€</option>
                    <option value="unlock">ğŸ”“ ì ê¸ˆ í•´ì œ</option>
                    <option value="teleport">ğŸŒ€ ìˆœê°„ì´ë™</option>
                    <option value="reveal">ğŸ‘ï¸ ì§€ë„ ê³µê°œ</option>
                </select>
            </div>

            <h2 style="margin-top: 20px;">âš™ï¸ ì•„íŠ¸ ì„¤ì •</h2>

            <div class="color-picker">
                <input type="color" id="itemColor" value="#ffd700">
                <span>ì•„ì´í…œ ìƒ‰ìƒ</span>
            </div>

            <div class="size-inputs">
                <div class="size-input">
                    <label>ë†’ì´ ë°°ìœ¨</label>
                    <input type="number" id="sizeHeight" value="1.0" step="0.1" min="0.1" max="3.0">
                </div>
                <div class="size-input">
                    <label>ë„ˆë¹„ ë°°ìœ¨</label>
                    <input type="number" id="sizeWidth" value="1.0" step="0.1" min="0.1" max="3.0">
                </div>
            </div>

            <div class="btn-group">
                <button class="btn btn-primary" onclick="savePattern()">ğŸ’¾ ì €ì¥</button>
                <button class="btn" onclick="exportCode()">ğŸ“‹ ì½”ë“œ ë³µì‚¬</button>
                <button class="btn" onclick="exportAllCode()">ğŸ“„ ì „ì²´ ë‚´ë³´ë‚´ê¸°</button>
                <button class="btn" onclick="toggleImportArea()">ğŸ“¥ ì½”ë“œ ê°€ì ¸ì˜¤ê¸°</button>
                <button class="btn btn-danger" onclick="resetCurrentItem()">ğŸ”„ í˜„ì¬ ì•„ì´í…œ ë³µì›</button>
                <button class="btn btn-danger" onclick="resetAllPatterns()">âš ï¸ ì „ì²´ ì´ˆê¸°í™”</button>
            </div>

            <div id="importArea" style="display: none; margin-top: 10px;">
                <textarea id="importCode" placeholder="ì—¬ê¸°ì— ì½”ë“œë¥¼ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”..."
                    style="width: 100%; height: 150px; background: #000; color: #0f0; border: 1px solid #0f3460;
                    border-radius: 5px; padding: 10px; font-family: monospace; font-size: 12px; resize: vertical;"></textarea>
                <div style="display: flex; gap: 10px; margin-top: 10px;">
                    <button class="btn btn-primary" onclick="importCode()">âœ… ê°€ì ¸ì˜¤ê¸°</button>
                    <button class="btn" onclick="toggleImportArea()">ì·¨ì†Œ</button>
                </div>
            </div>

            <div class="code-output" id="codeOutput" style="display: none;"></div>

            <div class="help-text">
                <strong>ì‚¬ìš©ë²•:</strong><br>
                1. ì™¼ìª½ì—ì„œ ì•„ì´í…œ ì„ íƒ<br>
                2. í¬ê¸° ë‹¨ê³„ ì„ íƒ (5=ê°€ê¹Œì›€, 1=ë©€ë¦¬)<br>
                3. íŒ”ë ˆíŠ¸ì—ì„œ ë¬¸ì ì„ íƒ<br>
                4. ê·¸ë¦¬ë“œì— í´ë¦­í•˜ì—¬ ê·¸ë¦¬ê¸°<br>
                5. ì €ì¥ ë²„íŠ¼ìœ¼ë¡œ ì ìš©
            </div>
        </div>
    </div>

    <script src="monster_patterns.js"></script>
    <script>
        // ì•„ì´í…œ ë¬¸ì ëª©ë¡ (MONSTER_PATTERNSì—ì„œ ì•„ì´í…œì¸ ê²ƒë“¤)
        const ITEM_CHARS = ['%', '!', 'Â¡', '/', '[', '*', '>', '~', '='];

        // ê¸°ë³¸ ì•„ì´í…œ ë°ì´í„° (MONSTER_PATTERNSì— ì—†ëŠ” ê²½ìš°)
        const DEFAULT_ITEM_DATA = {
            itemType: 'misc',
            rarity: 'common',
            value: 10,
            weight: 1.0,
            effect: 0,
            effectType: 'none',
            stackable: true
        };

        // í˜„ì¬ ìƒíƒœ
        let currentItem = '!';
        let currentScale = 5;
        let currentChar = 'â–ˆ';
        let currentTool = 'draw';
        let patterns = {};
        let isMouseDown = false;
        let dragMode = false;

        // ê·¸ë¦¬ë“œ í¬ê¸° (ìŠ¤ì¼€ì¼ë³„)
        const GRID_SIZES = {
            5: { cols: 7, rows: 7 },
            4: { cols: 5, rows: 5 },
            3: { cols: 3, rows: 3 },
            2: { cols: 2, rows: 2 },
            1: { cols: 1, rows: 1 }
        };

        // ASCII íŒ”ë ˆíŠ¸
        const ASCII_PALETTE = window.ASCII_PALETTE || {
            blocks: ['â–ˆ', 'â–“', 'â–’', 'â–‘', 'â–', 'â–Œ', 'â–€', 'â–„'],
            half: ['â–€', 'â–„', 'â–Œ', 'â–', 'â––', 'â–—', 'â–˜', 'â–'],
            shapes: ['â—†', 'â—‡', 'â—‹', 'â—', 'â–¡', 'â– ', 'â–³', 'â–½', 'â—', 'â–·', 'â˜…', 'â˜†'],
            misc: ['â”€', 'â”‚', 'â”Œ', 'â”', 'â””', 'â”˜', 'â”œ', 'â”¤', 'â”¬', 'â”´', 'â”¼', 'â•', 'â•‘', 'â•”', 'â•—', 'â•š', 'â•']
        };

        // ì•„ì´í…œ íŒ¨í„´ ì´ˆê¸°í™”
        function initPatterns() {
            // MONSTER_PATTERNSì—ì„œ ì•„ì´í…œ ì¶”ì¶œ
            for (const char of ITEM_CHARS) {
                if (MONSTER_PATTERNS[char]) {
                    patterns[char] = JSON.parse(JSON.stringify(MONSTER_PATTERNS[char]));
                    // ì•„ì´í…œ ì†ì„± ì¶”ê°€ (ì—†ìœ¼ë©´)
                    if (!patterns[char].itemData) {
                        patterns[char].itemData = { ...DEFAULT_ITEM_DATA };
                        // íƒ€ì… ìë™ ì„¤ì •
                        if (char === '!') patterns[char].itemData.itemType = 'consumable';
                        else if (char === 'Â¡') patterns[char].itemData.itemType = 'potion';
                        else if (char === '/') patterns[char].itemData.itemType = 'weapon';
                        else if (char === '[') patterns[char].itemData.itemType = 'armor';
                        else if (char === '*') patterns[char].itemData.itemType = 'gold';
                        else if (char === '~') patterns[char].itemData.itemType = 'scroll';
                        else if (char === '=') patterns[char].itemData.itemType = 'key';
                        else if (char === '>') patterns[char].itemData.itemType = 'misc';
                        else if (char === '%') patterns[char].itemData.itemType = 'misc';
                    }
                }
            }

            // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ì €ì¥ëœ íŒ¨í„´ ë¶ˆëŸ¬ì˜¤ê¸°
            const saved = localStorage.getItem('item_patterns');
            if (saved) {
                try {
                    const savedPatterns = JSON.parse(saved);
                    for (const [char, data] of Object.entries(savedPatterns)) {
                        patterns[char] = data;
                    }
                } catch (e) {
                    console.error('ì €ì¥ëœ íŒ¨í„´ ë¡œë“œ ì‹¤íŒ¨:', e);
                }
            }
        }

        // ì´ˆê¸°í™”
        function init() {
            initPatterns();
            renderItemList();
            renderScaleSelect();
            renderPalettes();
            renderGrid();
            updatePreview();
            updateSettingsUI();

            // ìƒ‰ìƒ ë³€ê²½ ì´ë²¤íŠ¸
            document.getElementById('itemColor').addEventListener('change', (e) => {
                patterns[currentItem].color = e.target.value;
                updatePreview();
            });

            // ì‚¬ì´ì¦ˆ ë³€ê²½ ì´ë²¤íŠ¸
            ['sizeHeight', 'sizeWidth'].forEach(id => {
                document.getElementById(id).addEventListener('change', updateSize);
            });

            // ì•„ì´í…œ ì†ì„± ë³€ê²½ ì´ë²¤íŠ¸
            ['itemType', 'itemRarity', 'itemValue', 'itemWeight', 'itemEffect', 'itemEffectType', 'itemStackable'].forEach(id => {
                document.getElementById(id).addEventListener('change', updateItemData);
            });

            // ë§ˆìš°ìŠ¤ ì´ë²¤íŠ¸
            document.addEventListener('mouseup', () => isMouseDown = false);
        }

        // ì•„ì´í…œ ëª©ë¡ ë Œë”ë§
        function renderItemList() {
            const container = document.getElementById('itemList');
            container.innerHTML = '';

            const typeLabels = {
                consumable: 'ì†Œë¹„',
                weapon: 'ë¬´ê¸°',
                armor: 'ë°©ì–´',
                potion: 'ë¬¼ì•½',
                scroll: 'ìŠ¤í¬ë¡¤',
                key: 'ì—´ì‡ ',
                gold: 'ê¸ˆí™”',
                misc: 'ê¸°íƒ€'
            };

            for (const [char, data] of Object.entries(patterns)) {
                const btn = document.createElement('button');
                btn.className = `item-btn ${char === currentItem ? 'active' : ''}`;
                const itemType = data.itemData?.itemType || 'misc';
                btn.innerHTML = `
                    <span class="char" style="color: ${data.color}">${char}</span>
                    <span>${data.name}</span>
                    <span class="type-badge type-${itemType}">${typeLabels[itemType] || 'ê¸°íƒ€'}</span>
                `;
                btn.onclick = () => selectItem(char);
                container.appendChild(btn);
            }
        }

        // í¬ê¸° ì„ íƒ ë Œë”ë§
        function renderScaleSelect() {
            const container = document.getElementById('scaleSelect');
            container.innerHTML = '';

            const labels = { 5: 'ë§¤ìš° ê°€ê¹Œì›€', 4: 'ê°€ê¹Œì›€', 3: 'ë³´í†µ', 2: 'ë©€ë¦¬', 1: 'ë§¤ìš° ë©€ë¦¬' };

            for (let i = 5; i >= 1; i--) {
                const btn = document.createElement('button');
                btn.className = `scale-btn ${i === currentScale ? 'active' : ''}`;
                btn.textContent = `${i}: ${labels[i]}`;
                btn.onclick = () => selectScale(i);
                container.appendChild(btn);
            }
        }

        // íŒ”ë ˆíŠ¸ ë Œë”ë§
        function renderPalettes() {
            const sections = {
                'paletteBlocks': ASCII_PALETTE.blocks,
                'paletteHalf': ASCII_PALETTE.half,
                'paletteShapes': ASCII_PALETTE.shapes,
                'paletteMisc': ASCII_PALETTE.misc
            };

            for (const [id, chars] of Object.entries(sections)) {
                const container = document.getElementById(id);
                if (!container) continue;
                container.innerHTML = '';

                for (const char of chars) {
                    const btn = document.createElement('button');
                    btn.className = `palette-char ${char === currentChar ? 'active' : ''}`;
                    btn.textContent = char;
                    btn.onclick = () => selectChar(char);
                    container.appendChild(btn);
                }
            }
        }

        // ê·¸ë¦¬ë“œ ë Œë”ë§
        function renderGrid() {
            const container = document.getElementById('grid');
            const size = GRID_SIZES[currentScale];
            const pattern = patterns[currentItem]?.patterns?.[currentScale] || [];

            container.style.gridTemplateColumns = `repeat(${size.cols}, 40px)`;
            container.innerHTML = '';

            for (let y = 0; y < size.rows; y++) {
                for (let x = 0; x < size.cols; x++) {
                    const cell = document.createElement('div');
                    cell.className = 'grid-cell';
                    cell.dataset.x = x;
                    cell.dataset.y = y;

                    const char = pattern[y]?.[x] || ' ';
                    cell.textContent = char;
                    cell.style.color = patterns[currentItem]?.color || '#fff';

                    cell.onclick = (e) => handleCellClick(x, y, e);
                    cell.onmousedown = (e) => {
                        if (dragMode) {
                            isMouseDown = true;
                            handleCellClick(x, y, e);
                        }
                    };
                    cell.onmouseenter = (e) => {
                        if (dragMode && isMouseDown) handleCellClick(x, y, e);
                    };

                    container.appendChild(cell);
                }
            }
        }

        // ì…€ í´ë¦­ ì²˜ë¦¬
        function handleCellClick(x, y, e) {
            e.preventDefault();

            const size = GRID_SIZES[currentScale];
            let pattern = patterns[currentItem].patterns[currentScale];

            if (!pattern || !Array.isArray(pattern)) {
                pattern = [];
                for (let i = 0; i < size.rows; i++) {
                    pattern.push(' '.repeat(size.cols));
                }
                patterns[currentItem].patterns[currentScale] = pattern;
            }

            let row = pattern[y].split('');

            if (currentTool === 'draw') {
                row[x] = currentChar;
            } else if (currentTool === 'erase') {
                row[x] = ' ';
            } else if (currentTool === 'fill') {
                fillArea(x, y, currentChar);
                renderGrid();
                updatePreview();
                return;
            }

            pattern[y] = row.join('');
            patterns[currentItem].patterns[currentScale] = pattern;

            renderGrid();
            updatePreview();
        }

        // ì˜ì—­ ì±„ìš°ê¸°
        function fillArea(startX, startY, newChar) {
            const size = GRID_SIZES[currentScale];
            let pattern = patterns[currentItem].patterns[currentScale];
            const targetChar = pattern[startY]?.[startX] || ' ';

            if (targetChar === newChar) return;

            const stack = [[startX, startY]];
            const visited = new Set();

            while (stack.length > 0) {
                const [x, y] = stack.pop();
                const key = `${x},${y}`;

                if (visited.has(key)) continue;
                if (x < 0 || x >= size.cols || y < 0 || y >= size.rows) continue;

                const currentCell = pattern[y]?.[x] || ' ';
                if (currentCell !== targetChar) continue;

                visited.add(key);

                let row = pattern[y].split('');
                row[x] = newChar;
                pattern[y] = row.join('');

                stack.push([x + 1, y], [x - 1, y], [x, y + 1], [x, y - 1]);
            }

            patterns[currentItem].patterns[currentScale] = pattern;
        }

        // ì•„ì´í…œ ì„ íƒ
        function selectItem(char) {
            currentItem = char;
            renderItemList();
            renderGrid();
            updatePreview();
            updateSettingsUI();
        }

        // í¬ê¸° ì„ íƒ
        function selectScale(scale) {
            currentScale = scale;
            renderScaleSelect();
            renderGrid();
        }

        // ë¬¸ì ì„ íƒ
        function selectChar(char) {
            currentChar = char;
            renderPalettes();
        }

        // ë„êµ¬ ì„ íƒ
        function setTool(tool) {
            currentTool = tool;
            document.querySelectorAll('.tool-btn').forEach(btn => {
                if (btn.id !== 'toolDrag') btn.classList.remove('active');
            });
            document.getElementById('tool' + tool.charAt(0).toUpperCase() + tool.slice(1)).classList.add('active');
        }

        // ë“œë˜ê·¸ ëª¨ë“œ í† ê¸€
        function toggleDragMode() {
            dragMode = !dragMode;
            const btn = document.getElementById('toolDrag');
            if (dragMode) {
                btn.classList.add('active');
                btn.textContent = 'âœ‹ ë“œë˜ê·¸ ON';
            } else {
                btn.classList.remove('active');
                btn.textContent = 'âœ‹ ë“œë˜ê·¸ ëª¨ë“œ';
            }
        }

        // ê·¸ë¦¬ë“œ ì§€ìš°ê¸°
        function clearGrid() {
            const size = GRID_SIZES[currentScale];
            const pattern = [];
            for (let i = 0; i < size.rows; i++) {
                pattern.push(' '.repeat(size.cols));
            }
            patterns[currentItem].patterns[currentScale] = pattern;
            renderGrid();
            updatePreview();
        }

        // ì¢Œìš° ë°˜ì „
        function flipHorizontal() {
            let pattern = patterns[currentItem].patterns[currentScale];
            if (!pattern) return;

            patterns[currentItem].patterns[currentScale] = pattern.map(row =>
                row.split('').reverse().join('')
            );
            renderGrid();
            updatePreview();
        }

        // ì„¤ì • UI ì—…ë°ì´íŠ¸
        function updateSettingsUI() {
            const data = patterns[currentItem];
            document.getElementById('itemColor').value = data.color || '#ffffff';
            document.getElementById('sizeHeight').value = data.size?.height || 1.0;
            document.getElementById('sizeWidth').value = data.size?.width || 1.0;

            // ì•„ì´í…œ ì†ì„±
            const itemData = data.itemData || DEFAULT_ITEM_DATA;
            document.getElementById('itemType').value = itemData.itemType || 'misc';
            document.getElementById('itemRarity').value = itemData.rarity || 'common';
            document.getElementById('itemValue').value = itemData.value || 10;
            document.getElementById('itemWeight').value = itemData.weight || 1.0;
            document.getElementById('itemEffect').value = itemData.effect || 0;
            document.getElementById('itemEffectType').value = itemData.effectType || 'none';
            document.getElementById('itemStackable').value = itemData.stackable !== false ? 'true' : 'false';
        }

        // ì‚¬ì´ì¦ˆ ì—…ë°ì´íŠ¸
        function updateSize() {
            patterns[currentItem].size = {
                height: parseFloat(document.getElementById('sizeHeight').value) || 1.0,
                width: parseFloat(document.getElementById('sizeWidth').value) || 1.0,
                weight: patterns[currentItem].size?.weight || 1.0
            };
        }

        // ì•„ì´í…œ ë°ì´í„° ì—…ë°ì´íŠ¸
        function updateItemData() {
            if (!patterns[currentItem].itemData) {
                patterns[currentItem].itemData = { ...DEFAULT_ITEM_DATA };
            }
            patterns[currentItem].itemData = {
                itemType: document.getElementById('itemType').value,
                rarity: document.getElementById('itemRarity').value,
                value: parseInt(document.getElementById('itemValue').value) || 10,
                weight: parseFloat(document.getElementById('itemWeight').value) || 1.0,
                effect: parseInt(document.getElementById('itemEffect').value) || 0,
                effectType: document.getElementById('itemEffectType').value,
                stackable: document.getElementById('itemStackable').value === 'true'
            };
            renderItemList();
        }

        // ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸
        function updatePreview() {
            const container = document.getElementById('previewAll');
            container.innerHTML = '';

            const color = patterns[currentItem]?.color || '#fff';

            for (let scale = 5; scale >= 1; scale--) {
                const pattern = patterns[currentItem]?.patterns?.[scale] || ['?'];

                const item = document.createElement('div');
                item.className = 'preview-item';
                item.innerHTML = `
                    <div class="label">í¬ê¸° ${scale}</div>
                    <pre style="color: ${color}; line-height: 1.2;">${pattern.join('\n')}</pre>
                `;
                container.appendChild(item);
            }
        }

        // ìƒˆ ì•„ì´í…œ ì¶”ê°€
        function addNewItem() {
            const char = document.getElementById('newItemChar').value.trim();
            const name = document.getElementById('newItemName').value.trim();
            const type = document.getElementById('newItemType').value;

            if (!char || !name) {
                alert('ë¬¸ìì™€ ì´ë¦„ì„ ëª¨ë‘ ì…ë ¥í•˜ì„¸ìš”.');
                return;
            }

            if (patterns[char]) {
                alert('ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ë¬¸ìì…ë‹ˆë‹¤.');
                return;
            }

            // ê¸°ë³¸ íŒ¨í„´
            patterns[char] = {
                name: name,
                color: '#ffd700',
                size: { height: 0.5, width: 0.5, weight: 0.5 },
                stats: { hp: 0, power: 0, defense: 0, detection: 0, xp: 0, gold: 0, strength: 'none', weakness: 'none' },
                itemData: {
                    itemType: type,
                    rarity: 'common',
                    value: 10,
                    weight: 1.0,
                    effect: 0,
                    effectType: 'none',
                    stackable: true
                },
                patterns: {
                    5: [
                        "       ",
                        "       ",
                        "  â–„â–„â–„  ",
                        "  â–ˆ" + char + "â–ˆ  ",
                        "  â–€â–€â–€  ",
                        "       ",
                        "       "
                    ],
                    4: [
                        "     ",
                        " â–„â–„â–„ ",
                        " â–ˆ" + char + "â–ˆ ",
                        " â–€â–€â–€ ",
                        "     "
                    ],
                    3: [
                        "   ",
                        " " + char + " ",
                        "   "
                    ],
                    2: [
                        "  ",
                        char + " "
                    ],
                    1: [char]
                }
            };

            document.getElementById('newItemChar').value = '';
            document.getElementById('newItemName').value = '';

            renderItemList();
            selectItem(char);
        }

        // íŒ¨í„´ ì €ì¥
        function savePattern() {
            localStorage.setItem('item_patterns', JSON.stringify(patterns));
            alert('ì•„ì´í…œ íŒ¨í„´ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!\n\nê²Œì„ì— ì ìš©í•˜ë ¤ë©´ "ì „ì²´ ë‚´ë³´ë‚´ê¸°"ë¥¼ ëˆŒëŸ¬\nmonster_patterns.js íŒŒì¼ì„ ì—…ë°ì´íŠ¸í•˜ì„¸ìš”.');
        }

        // ë‹¨ì¼ ì•„ì´í…œ ì½”ë“œ ë³µì‚¬
        function exportCode() {
            const char = currentItem;
            const data = patterns[char];
            const stats = data.stats || { hp: 0, power: 0, defense: 0, detection: 0, xp: 0, gold: 0, strength: 'none', weakness: 'none' };
            const itemData = data.itemData || DEFAULT_ITEM_DATA;

            const code = `'${char}': {
    name: '${data.name}',
    color: '${data.color}',
    size: { height: ${data.size?.height || 0.5}, width: ${data.size?.width || 0.5}, weight: ${data.size?.weight || 0.5} },
    stats: { hp: ${stats.hp}, power: ${stats.power}, defense: ${stats.defense}, detection: ${stats.detection}, xp: ${stats.xp}, gold: ${stats.gold}, strength: '${stats.strength}', weakness: '${stats.weakness}' },
    itemData: { itemType: '${itemData.itemType}', rarity: '${itemData.rarity}', value: ${itemData.value}, weight: ${itemData.weight}, effect: ${itemData.effect}, effectType: '${itemData.effectType}', stackable: ${itemData.stackable} },
    patterns: {
${Object.entries(data.patterns).map(([scale, pattern]) => `        ${scale}: [
${pattern.map(row => `            "${row}"`).join(',\n')}
        ]`).join(',\n')}
    }
}`;

            document.getElementById('codeOutput').style.display = 'block';
            document.getElementById('codeOutput').textContent = code;

            navigator.clipboard.writeText(code).then(() => {
                alert('ì½”ë“œê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
            });
        }

        // í˜„ì¬ ì•„ì´í…œ ë³µì›
        function resetCurrentItem() {
            if (!confirm(`'${patterns[currentItem].name}' íŒ¨í„´ì„ ì›ë˜ëŒ€ë¡œ ë³µì›í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì €ì¥í•˜ì§€ ì•Šì€ ë³€ê²½ì‚¬í•­ì´ ì‚¬ë¼ì§‘ë‹ˆë‹¤.`)) {
                return;
            }

            if (MONSTER_PATTERNS[currentItem]) {
                patterns[currentItem] = JSON.parse(JSON.stringify(MONSTER_PATTERNS[currentItem]));
                if (!patterns[currentItem].itemData) {
                    patterns[currentItem].itemData = { ...DEFAULT_ITEM_DATA };
                }
                renderGrid();
                updatePreview();
                updateSettingsUI();
                alert('íŒ¨í„´ì´ ì›ë˜ëŒ€ë¡œ ë³µì›ë˜ì—ˆìŠµë‹ˆë‹¤.');
            } else {
                alert('ì›ë³¸ íŒ¨í„´ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            }
        }

        // ì „ì²´ íŒ¨í„´ ì´ˆê¸°í™”
        function resetAllPatterns() {
            if (!confirm('âš ï¸ ê²½ê³ !\n\nëª¨ë“  ì•„ì´í…œ íŒ¨í„´ì„ ì›ë˜ëŒ€ë¡œ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì €ì¥í•˜ì§€ ì•Šì€ ëª¨ë“  ë³€ê²½ì‚¬í•­ì´ ì‚¬ë¼ì§‘ë‹ˆë‹¤.')) {
                return;
            }

            if (!confirm('âš ï¸ ì •ë§ë¡œ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!')) {
                return;
            }

            patterns = {};
            initPatterns();
            localStorage.removeItem('item_patterns');
            renderItemList();
            renderGrid();
            updatePreview();
            updateSettingsUI();
            alert('ëª¨ë“  ì•„ì´í…œ íŒ¨í„´ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
        }

        // ì½”ë“œ ê°€ì ¸ì˜¤ê¸° ì˜ì—­ í† ê¸€
        function toggleImportArea() {
            const area = document.getElementById('importArea');
            area.style.display = area.style.display === 'none' ? 'block' : 'none';
            if (area.style.display === 'block') {
                document.getElementById('importCode').value = '';
                document.getElementById('importCode').focus();
            }
        }

        // ì½”ë“œ ê°€ì ¸ì˜¤ê¸°
        function importCode() {
            const code = document.getElementById('importCode').value.trim();

            if (!code) {
                alert('ì½”ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            try {
                let parsedData;

                if (code.match(/^['"].\s*['"]:\s*\{/)) {
                    parsedData = eval('({' + code + '})');
                } else if (code.startsWith('{')) {
                    parsedData = eval('(' + code + ')');
                } else {
                    throw new Error('ì¸ì‹í•  ìˆ˜ ì—†ëŠ” ì½”ë“œ í˜•ì‹ì…ë‹ˆë‹¤.');
                }

                if (typeof parsedData !== 'object' || parsedData === null) {
                    throw new Error('ìœ íš¨í•œ íŒ¨í„´ ë°ì´í„°ê°€ ì•„ë‹™ë‹ˆë‹¤.');
                }

                let importedCount = 0;
                for (const [char, data] of Object.entries(parsedData)) {
                    if (data.name && data.patterns) {
                        patterns[char] = data;
                        if (!patterns[char].itemData) {
                            patterns[char].itemData = { ...DEFAULT_ITEM_DATA };
                        }
                        importedCount++;
                    }
                }

                if (importedCount === 0) {
                    throw new Error('ê°€ì ¸ì˜¬ ìˆ˜ ìˆëŠ” íŒ¨í„´ì´ ì—†ìŠµë‹ˆë‹¤.');
                }

                renderItemList();
                renderGrid();
                updatePreview();
                updateSettingsUI();
                toggleImportArea();

                alert(`${importedCount}ê°œì˜ ì•„ì´í…œ íŒ¨í„´ì„ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤!`);

            } catch (e) {
                alert('ì½”ë“œ íŒŒì‹± ì˜¤ë¥˜:\n' + e.message);
                console.error('Import error:', e);
            }
        }

        // ì „ì²´ ì½”ë“œ ë‚´ë³´ë‚´ê¸°
        function exportAllCode() {
            let code = `// === ì•„ì´í…œ íŒ¨í„´ ===\n`;

            for (const [char, data] of Object.entries(patterns)) {
                const stats = data.stats || { hp: 0, power: 0, defense: 0, detection: 0, xp: 0, gold: 0, strength: 'none', weakness: 'none' };
                const itemData = data.itemData || DEFAULT_ITEM_DATA;
                code += `    '${char}': {
        name: '${data.name}',
        color: '${data.color}',
        size: { height: ${data.size?.height || 0.5}, width: ${data.size?.width || 0.5}, weight: ${data.size?.weight || 0.5} },
        stats: { hp: ${stats.hp}, power: ${stats.power}, defense: ${stats.defense}, detection: ${stats.detection}, xp: ${stats.xp}, gold: ${stats.gold}, strength: '${stats.strength}', weakness: '${stats.weakness}' },
        itemData: { itemType: '${itemData.itemType}', rarity: '${itemData.rarity}', value: ${itemData.value}, weight: ${itemData.weight}, effect: ${itemData.effect}, effectType: '${itemData.effectType}', stackable: ${itemData.stackable} },
        patterns: {
${Object.entries(data.patterns).map(([scale, pattern]) => `            ${scale}: [
${pattern.map(row => `                "${row}"`).join(',\n')}
            ]`).join(',\n')}
        }
    },\n`;
            }

            document.getElementById('codeOutput').style.display = 'block';
            document.getElementById('codeOutput').textContent = code;

            navigator.clipboard.writeText(code).then(() => {
                alert('ì „ì²´ ì•„ì´í…œ ì½”ë“œê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!\n\nmonster_patterns.js íŒŒì¼ì— ë¶™ì—¬ë„£ìœ¼ì„¸ìš”.');
            });
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        window.onload = init;
    </script>
</body>
</html>
